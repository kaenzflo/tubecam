<h1>Sequenz <%= @sequence.sequence_no.to_s %></h1>

<div class="medium-detail">
  <div class="image-description">
    <table class="table table-striped table-sm table-responsive table-hover" style="max-width: 400px;">
      <tr>
        <td><b>Aufnahmedatum:</b></td>
        <td><%= @medium.datetime.strftime("%d.%m.%Y %H:%M:%S") %></td>
      </tr>
      <tr>
        <td><b>Koordinate:</b></td>
        <td><%= @medium.longitude %>, <%= @medium.latitude %></td>
      </tr>
      <tr>
        <td><b>Medientyp:</b></td>
        <td> <%= @medium.mediatype %></td>
      </tr>
      <tr>
        <td><b>Frames:</b></td>
        <td> <%= @medium.frame %></td>
      </tr>
    </table>
  </div>
  <div class="image-links">
    <%= link_to 'Tubecam ' + @tubecam_device.serialnumber, tubecam_device_path(@sequence.tubecam_device_id), class: 'btn btn-primary' %>
    <%= link_to 'Standort auf Karte anzeigen', maps_path(:longitude => @medium.longitude, :latitude => @medium.latitude), class: 'btn btn-primary' %>
    <% if !@annotations.empty? %>
        <%= link_to 'Annotieren', { controller: 'annotations', action: 'specific', :id => @medium.id }, class: 'btn btn-primary' %>
    <% end %>
  </div>
</div>


<div class="gallery">
  <div class="sequence">
    <% @media.order('frame ASC').each do |medium| %>
        <% medium = Coordinates.wgs_to_ch(medium) %>
        <div class="item">
          <a href="<%= @cloud_resource_image_url + medium.filename_hash %>" data-imagelightbox="f">
          <%= image_tag(@cloud_resource_thumbnail_url + medium.filename_hash) %>
        </a>

        </div>
    <% end %>
  </div>
</div>
</div>

<div class="medium-detail">
  <div class="image-links">
  <% if @annotations.empty? %>
        <h4>Es wurde noch keine Annotation getÃ¤tigt.</h4>
        <%= link_to 'Annotieren', { controller: 'annotations', action: 'specific' , :id => @sequence.media.first.id }, class: 'btn btn-primary' %>
  <% else %>
    <table class="table table-striped table-sm table-responsive table-hover">
      <thead>
      <tr>
        <th>Name</th>
        <th>Gattung</th>
        <th>Art</th>
        <th>Familie</th>
        <th>Lookup-Index</th>
        <th>Datum</th>
        <th>Benutzername</th>
        <th>Bearbeiten</th>
        <th>Verifiziert</th>
        <% if user_signed_in? && current_user.verified_spotter_role? %>
            <th>Verifikation</th>
        <% end %>
        <th colspan="3"></th>
      </tr>
      </thead>

      <tbody>
      <% @annotations.each do |annotation| %>
        <% lookup_id = annotation.annotations_lookup_table_id - 1 %>
          <tr>
            <td><%= @annotations_lookup_table[lookup_id].name %></td>
            <td><%= @annotations_lookup_table[lookup_id].genus %></td>
            <td><%= @annotations_lookup_table[lookup_id].species %></td>
            <td><%= @annotations_lookup_table[lookup_id].family %></td>
            <td><%= @annotations_lookup_table[lookup_id].annotation_id %></td>
            <td><%= annotation.created_at.strftime("%d.%m.%Y %H:%M:%S") %></td>
            <td><%= annotation.user.username %></td>
            <% if current_user.id == annotation.user_id %>
                <td><%= link_to 'LÃ¶schen', :controller => 'annotations', :action => 'destroy', :id => annotation.id, :sequence_id => annotation.sequence.id%></td>
            <% else %>
            <td>-</td>
            <% end %>

            <% if annotation.verified_id.nil? %>
              <td>-</td>
                <% if !@annotations.where.not(verified_id: nil).empty? %>
                    <td>-</td>
                <% else %>
                    <td><%= link_to 'Verifizieren', controller: 'sequences', action: 'verify', :annotation_id => annotation.id %></td>
                <% end %>
            <% else %>
              <td>ðŸŽ–</td>
                <% if user_signed_in? && current_user.verified_spotter_role? %>
                    <td><%= link_to 'Entfernen', controller: 'sequences', action: 'unverify', :annotation_id => annotation.id %></td>
                <% end %>
            <% end %>
          </tr>
      <% end %>
      </tbody>
    </table>
  <% end %>
  </div>
</div>




<%= javascript_include_tag 'imagelightbox.min' %>
<%= javascript_include_tag 'custom_imagelightbox' %>