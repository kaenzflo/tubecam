<% @page_title=t '.title' %>
<h1></h1>
<div class="medium-detail">
  <div class="image-detail">
    <%= image_tag(@image_url + @medium.filename_hash) %>
  </div>
  <div class="image-description">
    <p>
      <strong><%= t 'activerecord.attributes.medium.mediatype' %></strong>
      <%= @medium.mediatype %>
    </p>

    <p>
      <strong><%= t 'activerecord.attributes.medium.datetime' %></strong>
      <%= @medium.datetime.strftime("%d.%m.%Y %H:%M:%S") %>
    </p>

    <% if user_signed_in? %>
      <p>
        <strong><%= t 'activerecord.attributes.medium.longitude' %></strong>
        <%= @medium.longitude %>
      </p>

      <p>
        <strong><%= t 'activerecord.attributes.medium.latitude' %></strong>
        <%= @medium.latitude %>
      </p>
    <% end %>
    
    <p>
      <strong><%= t 'activerecord.attributes.medium.sequence_id' %></strong>
      <%= @medium.sequence %>
    </p>

    <p>
      <strong><%= t 'activerecord.attributes.medium.frame' %></strong>
      <%= @medium.frame %>
    </p>
  </div>
  <div class="image-links">
      <%= link_to (t 'link.to_tubecam') + ' ' + @tubecam_device.serialnumber, tubecam_device_path(@medium.tubecam_device_id), class: 'btn btn-primary' %>
      <%= link_to (t 'link.to_location'), maps_path(:longitude => @medium.longitude, :latitude => @medium.latitude), class: 'btn btn-primary' %>
    <% if !@annotations.empty? %>
        <%= link_to (t 'link.to_annotate'), new_annotation_path, :id => @medium.id, class: 'btn btn-primary' %>
      <% end %>
  </div>
</div>


<div class="medium-detail">
  <div class="image-links">
  <% if @annotations.empty? %>
        <h4><%= t 'sequences.show.no_annotations' %></h4>
        <%= link_to (t '.first_annotation'), new_annotation_path, :id => @medium.id, class: 'btn btn-primary' %>
  <% else %>
    <table class="table table-striped table-sm table-responsive table-hover">
      <thead>
      <tr>
        <th><%= t 'activerecord.attributes.annotation.id' %></th>
        <th><%= t 'activerecord.attributes.annotations_lookup_table.name' %>Name</th>
        <th><%= t 'activerecord.attributes.annotations_lookup_table.family' %>Familie</th>
        <th><%= t 'activerecord.attributes.annotations_lookup_table.genus' %></th>
        <th><%= t 'activerecord.attributes.annotations_lookup_table.species' %></th>
        <th><%= t 'activerecord.attributes.annotations_lookup_table.created_at' %></th>
        <th colspan="3"></th>
      </tr>
      </thead>

      <tbody>
      <% @annotations.each do |annotation| %>
        <% lookup_id = annotation.annotations_lookup_table_id %>
          <tr>
            <td><%= @annotations_lookup_table[lookup_id].annotation_id %></td>
            <td><%= @annotations_lookup_table[lookup_id].name %></td>
            <td><%= @annotations_lookup_table[lookup_id].family %></td>
            <td><%= @annotations_lookup_table[lookup_id].genus %></td>
            <td><%= @annotations_lookup_table[lookup_id].species %></td>
            <td><%= annotation.created_at.strftime("%d.%m.%Y %H:%M:%S") %></td>
            <% if current_user.id == annotation.user_id %>
              <td><%= link_to (t 'action.destroy'), @medium, method: :delete, data: { confirm: 'Soll die Annotation wirklich unwiederruflich gelÃ¶scht werden?' } %></td>
            <% end %>
            <% if current_user.verified_spotter_role? %>
                <% if !annotation.verified_id.nil? %>
                    <td><%= link_to (t 'sequences.show.verify') %></td>
                <% else %>
                    <td><%= link_to (t 'sequences.show.unverify') %></td>
                <% end %>
            <% end %>
          </tr>
      <% end %>
      </tbody>
    </table>
  <% end %>
  </div>
</div>

